<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro de Exames v2.0</title>
    <link rel="stylesheet" href="../../styles/registros.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline';">
    <script>
      // Aplicar tema antes da página ser renderizada
      (function() {
        try {
          const savedTheme = localStorage.getItem('theme') || 'azul';
          // Remover classes de tema do html
          document.documentElement.classList.remove('dark-theme', 'light-theme', 'theme-azul');
          
          // Aplicar tema no html (o body será atualizado pelo script principal)
          if (savedTheme === 'dark') {
            document.documentElement.classList.add('dark-theme');
          } else if (savedTheme === 'light') {
            document.documentElement.classList.add('light-theme');
          } else if (savedTheme === 'blue' || savedTheme === 'azul') {
            document.documentElement.classList.add('theme-azul');
          }
        } catch (e) {
          console.error('Erro ao aplicar tema:', e);
        }
      })();
    </script>
</head>

<body>
    <header class="header-container">
        <button onclick="window.location.href='../index.html'" class="home-button" title="Voltar para a página inicial">Home</button>
        <h1>Registro de Pacientes</h1>
    </header>

    <div class="table-container">

        <div class="search-bar">
            <div class="search-bar0">
                <!-- Modal de Cadastro/Edição -->
                <div id="modalForm" class="modal" style="display: none;">
                    <div class="modal-content">
                        <span class="close" onclick="fecharModal()">&times;</span>
                        <h2 id="modalTitle">Novo Registro</h2>
                        <form id="formExame" onsubmit="salvarExame(event)">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <input type="text" id="nomePaciente" name="nomePaciente" placeholder="Nome do Paciente"
                                    required style="flex: 2;">
                                <select id="modalidade" name="modalidade" required style="flex: 1;">
                                    <option value="" disabled selected>Selecione a Modalidade</option>
                                    <option value="Raiox">RX</option>
                                    <option value="Tomografia">TC</option>
                                    <option value="Ressonancia">RM</option>
                                    <option value="Densitometria">DO</option>
                                    <option value="Mamografia">MG</option>
                                </select>
                                <input type="text" id="observacoes" name="observacoes" placeholder="Exame Realizado"
                                    required style="flex: 1.5;">
                                <input type="text" id="numeroAcesso" name="numeroAcesso" placeholder="Número de Acesso"
                                    required style="flex: 1;">
                            </div>
                            <div style="display: flex; align-items: center; gap: 10px; margin-top: 10px;">
                                <input type="datetime-local" id="dataHoraExame" name="dataHoraExame" style="flex: 1.5;">
                                <input type="text" id="nomeTecnico" name="nomeTecnico"
                                    placeholder="Técnico de Radiologia" required style="flex: 2;">
                                <button type="submit" style="flex: 1;">Registrar</button>
                                <button type="button" onclick="limparCampos()" style="flex: 1;">Limpar</button>
                            </div>
                        </form>
                    </div>
                </div>
                <div class="search-bar2">

                    <button type="button" onclick="abrirModal('novo')" style="font-weight: 600; ">Novo Registro</button>

                </div>
                <div class="search-bar1">
                    <button type="button" id="relatorio">Relatório Registros</button>
                    <button type="button" id="btnFiltrarAvancado">Filtro Avançado</button>
                    <button type="button" id="btnEditarRegistro" onclick="abrirModal('editar')">Editar</button>
                    <button type="button" id="btnExcluirRegistro">Excluir</button>
                </div>
            </div>

            <div id="filtroAvancadoContainer" style="display: none;">
                <div class="filter-content">
                    <div class="filter-options">
                        <label>
                            <span>Modalidade:</span>
                            <select id="filtroModalidade">
                                <option value="">Todas as Modalidades</option>
                                <option value="Raiox">RX</option>
                                <option value="Tomografia">TC</option>
                                <option value="Ressonancia">RM</option>
                                <option value="Densitometria">DO</option>
                                <option value="Mamografia">MG</option>
                            </select>
                        </label>

                        <div class="date-range">
                            <div class="date-field">
                                <label>Data e Hora Inicial:</label>
                                <div class="datetime-input">
                                    <input type="date" id="dataInicio">
                                    <input type="time" id="horaInicio" value="00:00">
                                </div>
                            </div>
                            <div class="date-field">
                                <label>Data e Hora Final:</label>
                                <div class="datetime-input">
                                    <input type="date" id="dataFim">
                                    <input type="time" id="horaFim" value="23:59">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="filter-buttons">
                        <button type="button" id="btnAplicarFiltroAvancado">Aplicar Filtro</button>
                        <button type="button" id="btnLimparFiltroAvancado">Limpar Filtro</button>
                    </div>
                </div>
            </div>

            <table>

                <thead class="thead-info">
                    <tr>
                        <th colspan="2" style="text-align: left;">
                            <div class="search-input-container">
                                <input type="text" id="searchInput" placeholder="Pesquisar registros...">
                                <button type="button" id="btnLimparPesquisa" class="clear-search"
                                    style="display: none;">&times;</button>
                            </div>
                        </th>
                        <th colspan="5" id="infoRegistros"
                            style="text-align: right; padding-right: 10px; font-weight: 600; font-size: .75rem;">
                            Exibindo 0 de 0 registros</th>

                    </tr>
                </thead>
                <thead class="thead-columns">
                    <tr>
                        <th data-sort="asc">Nome do Paciente</th>
                        <th data-sort="asc">Modalidade</th>
                        <th data-sort="asc">Exame Realizado</th>
                        <th data-sort="asc">Número de Acesso</th>
                        <th data-sort="asc">Data e Hora</th>
                        <th data-sort="asc">Técnico</th>
                        <th>Obs</th>
                    </tr>
                </thead>
                <tbody id="listaExames">
                    <!-- Registros serão adicionados dinamicamente aqui -->
                </tbody>
            </table>

            <div class="load-more-container">
                <button type="button" id="btnCarregarMais" onclick="carregarMaisRegistros()">Exibir Mais</button>
            </div>
        </div>

        <!-- Modal de Exportação -->
        <div id="modalExportar" class="modal" style="display: none;">
            <div class="modal-content">
                <span class="close" onclick="fecharModalExportar()">&times;</span>
                <h2>Exportar Registros</h2>

                <!-- Adicionar opções de filtro -->
                <div class="export-filter">
                    <label>
                        <input type="radio" name="filtroExport" value="todos" checked>
                        Exportar todos os registros
                    </label>
                    <label>
                        <input type="radio" name="filtroExport" value="periodo">
                        Exportar por período
                    </label>

                    <!-- Campos de data que serão mostrados quando "Exportar por período" for selecionado -->
                    <div id="exportDateFields" style="display: none;">
                        <div class="date-inputs">
                            <div class="date-field">
                                <label>Data e Hora Inicial:</label>
                                <div class="datetime-input">
                                    <input type="date" id="exportDataInicio">
                                    <input type="time" id="exportHoraInicio" value="00:00">
                                </div>
                            </div>
                            <div class="date-field">
                                <label>Data e Hora Final:</label>
                                <div class="datetime-input">
                                    <input type="date" id="exportDataFim">
                                    <input type="time" id="exportHoraFim" value="23:59">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="export-buttons">
                    <button type="button" onclick="exportarRegistros('txt')">Exportar como TXT</button>
                    <button type="button" onclick="exportarRegistros('pdf')">Exportar como PDF</button>
                    <button type="button" id="exportarCSV">Exportar Excel</button>
                    <button type="button" onclick="exportarRegistros('backup')">Exportar Backup</button>
                    <button type="button" onclick="fecharModalExportar()">Cancelar</button>
                </div>
            </div>
        </div>

        <!-- Atualizar o modal de confirmação -->
        <div id="modalConfirmacao" class="modal">
            <div class="modal-content">
                <span class="close">&times;</span>
                <h2>Confirmar Exclusão</h2>
                <p>Você tem certeza que deseja excluir este registro?</p>
                <div class="modal-buttons">
                    <button type="button" class="btn-confirmar">Confirmar</button>
                    <button type="button" class="btn-cancelar">Cancelar</button>
                </div>
            </div>
        </div>

        <!-- Modal de Observações -->
        <div id="modalObservacoes" class="modal">
            <div class="modal-content">
                <span class="close" onclick="fecharModalObservacoes()">&times;</span>
                <h2>Observações Adicionais</h2>
                <textarea id="observacoesAdicionais"
                    placeholder="Digite aqui as observações adicionais sobre o exame..." spellcheck="true"></textarea>
                <div class="modal-buttons">
                    <button type="button" class="btn-confirmar" onclick="salvarObservacoes()">Salvar</button>
                    <button type="button" class="btn-cancelar" onclick="fecharModalObservacoes()">Cancelar</button>
                </div>
            </div>
        </div>

        <!-- Modal de Importação -->
        <div id="modalImportacao" class="modal">
            <div class="modal-content">
                <span class="close">&times;</span>
                <h2>Importar Registros</h2>
                <p>Como você deseja importar os novos registros?</p>
                <div class="modal-buttons">
                    <button type="button" class="btn-substituir">Substituir Existentes</button>
                    <button type="button" class="btn-adicionar">Adicionar aos Existentes</button>
                    <button type="button" class="btn-cancelar">Cancelar</button>
                </div>
            </div>
        </div>

        <!-- Modal de Gráfico -->
        <div id="modalGrafico" class="modal">
            <div class="modal-content">
                <span class="close" onclick="fecharModalGrafico()">&times;</span>
                <h2>Análise dos Exames Médicos</h2>
                <div class="grafico-container">
                    <div class="controls">
                        <div class="dropdown">
                            <button id="modalidadeDropdownButton" class="dropdown-button">Selecione a Modalidade</button>
                            <ul id="modalidadeDropdownMenu" class="dropdown-menu">
                                <li data-modalidade="Tudo">Todas as Modalidades</li>
                                <li data-modalidade="Raiox">RX</li>
                                <li data-modalidade="Tomografia">TC</li>
                                <li data-modalidade="Ressonancia">RM</li>
                                <li data-modalidade="Densitometria">DO</li>
                                <li data-modalidade="Mamografia">MG</li>
                            </ul>
                        </div>
                        <!-- Novo menu para selecionar o ano -->
                        <div class="dropdown">
                            <button id="yearDropdownButton" class="dropdown-button">Selecione o Ano</button>
                            <ul class="dropdown-menu" id="yearDropdownMenu">
                                <!-- Os anos serão adicionados dinamicamente -->
                            </ul>
                        </div>
                        <button id="exportPDF" class="export-button">Exportar PDF</button>
                    </div>
                    <div class="content">
                        <div class="chart-container">
                            <canvas id="barChart"></canvas>
                        </div>
                        <div class="relatorio">
                            <h3>Relatório de Exames</h3>
                            <div id="relatorioContent"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script src="../../scripts/registros/registros.js"></script>
    </body>
</html>